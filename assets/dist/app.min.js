/*! Little Alchemy Helper - v0.1.0 - 2013-12-16
* Copyright (c) 2013; Licensed  */
function getQueryOption(a){a=a.replace(/[\[]/,"\\\\[").replace(/[\]]/,"\\\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?!1:decodeURIComponent(c[1].replace(/\+/g," "))}function cleanHeader(){$library.find("h3").html(completedCount?"Remaining Elements":"&nbsp;"),$item.hide().filter(":not(.completed)").show()}function cleanQueries(a){a=a?a:[],-1===$.inArray("completed",a)&&$("#showCompleted").removeClass("btn-purple").addClass("btn-light").find("span").html("show"),-1===$.inArray("filter",a)&&$("#filter").trigger("clear"),-1===$.inArray("search",a)&&$("#search").trigger("clear")}function filterMake(a){a?(cleanQueries(["filter"]),$item.show(),$item.filter(":data(composition[!*]="+a+")").hide().end(),$library.find("h3").html("Things you can make with: "+a).end().find(".clearQuery").show()):cleanHeader()}function filterSearch(a){a?(cleanQueries(["search"]),$item.hide(),$item.find("h5:contains('"+a.toLowerCase()+"')").parent().show(),$item.filter(":visible").size()?$library.find("h3").html("Elements found with: "+a).end().find(".clearQuery").show():$library.find("h3").html("Nothing found")):cleanHeader()}function buildMake(a,b){var c=[];return _.each(a,function(a,d){a.composition.indexOf(b)>-1&&c.push(d)}),c.join(", ")}var base,names,completedCount,lahCookie,$library,$item,candyPack=[270,271,272,273,274,275,276,277,278,279,280,291,292,293,294,295,296,297,298,299,320,321,322,323,324,325,326,327,328,329],CookieClass=function(){this.name="lah",this.cookie=$.cookie(this.name),this.imported=!1,this.set=function(b){$.cookie(this.name)||$.cookie(this.name,b);var c=$.cookie(this.name).split("|");c.push(b),c=c.unique(),$.cookie(this.name,c.unique().join("|")),completedCount=c.length,a()},this.getAll=function(){if(!$.cookie(this.name)&&!getQueryOption("import"))return[];getQueryOption("import")&&!this.imported&&($.cookie(this.name,getQueryOption("import").split(",").join("|")),this.imported=!0);var b=$.cookie(this.name).split("|");if(isNaN(parseInt(b[0],10))){var c,d=[];_.each(b,function(a){c=names.indexOf(a),d.push(c)}),b.length===d.length&&($.cookie(this.name,d.join("|")),b=d)}return b=$.map(b,function(a){return parseInt(a,10)}),completedCount=b.length,a(),b},this.remove=function(b){if(!$.cookie(this.name))return!1;var c=$.cookie(this.name).split("|");$.inArray(b,c)>-1&&c.splice($.inArray(b,c),1),c=c.unique(),$.cookie(this.name,c.join("|")),completedCount=c.length,a()},this.reset=function(){$.removeCookie(this.name),this.cookie=void 0,completedCount=0,a()};var a=function(){var a=$library.find("h3").html().indexOf("with")>-1;completedCount?($("#completedOptions").show(),a||$library.find("h3").html("Remaining Elements")):($("#completedOptions").hide(),a||$library.find("h3").html("&nbsp;")),$("#completedCount").find("span").html(completedCount)}};$(function(){$library=$("#library"),lahCookie=new CookieClass,$.getJSON("assets/data/base.json",function(a){base=a.base,$.getJSON("assets/data/names.json",function(a){if(names=a.lang,base&&names){var b,c,d,e,f="",g=[],h=[],i=[];for(_.each(base,function(a,b){console.log(a,b),h=[],4>b&&g.push([]),_.each(base,function(a){i=[],_.each(a,function(){})})}),b=0;b<base.length;b++){for(h=[],4>b&&g.push([]),c=4;c<base.length;c++){for(i=[],d=0;d<base[c].length;d++)(base[c][d][0]===b||base[c][d][1]===b)&&h.push(names[c]),i.push(names[base[c][d][0]]+" + "+names[base[c][d][1]]);b>=4&&g.push(i)}-1===$.inArray(b,candyPack)&&(console.log(h.length),e=$.inArray(b,lahCookie.getAll())>-1,f+='<li id="'+b+'" title="'+names[b]+'" class="item thumbnail'+(h.length?"":" finalElement")+(e?" completed":"")+'" data-composition="'+g[b].join(";")+'" data-make="'+h.join(", ")+'">\n',f+='	<div class="buttons"><a href="#" class="info"><i class="fa fa-eye"></i></a><a href="#" title="mark as completed" class="adder"></a><a href="#" title="things you can make with..." class="filter'+(h.length?"":" disabled")+'">'+(h.length?'<i class="fa fa-external-link-square"></i>':"")+"</a></div>\n",f+='	<div class="image"><img src="assets/images/blank_icon.png" data-src="http://littlealchemy.com/img/base/'+(b+1)+'.png"/></div>\n',f+="	<h5>"+names[b]+"</h5>\n",f+="</li>\n")}$library.find("ul").append(f),$item=$library.find(".item"),$item.filter(":gt(3)").sortElements(function(a,b){return $(a).prop("title")>$(b).prop("title")?1:-1}),$item.tooltip(),$item.find("img").unveil(),$library.find("h3").html(completedCount?"Remaining Elements":"&nbsp;"),$("header h3").html(base.length+" elements")}else $library.find("ul").append('<li class="warning">Something went wrong. Please try again.</li>')})}),"iframe"===getQueryOption("type")&&(getQueryOption("version")?setTimeout(function(){$("#reloader").is(":visible")&&$("#reloader").fadeOut()},7500):$("#reloader").find("span").html("You are using an old version of the bookmarklet. Please remove it from your bookmarks bar and drag again<h5>"+$("blockquote").find("h5").html()+"</h5>"),$("#reloader").show(),$("header.jumbotron h4").hide(),$("#showCheats").prop("checked",!0).change()),$(document).on("click",".item:not(.completed) .adder",function(a){a.preventDefault();var b=$(this);lahCookie.set(b.parents(".item").prop("id")),b.parents(".item").addClass("completed").hide()}).on("click",".item.completed .adder",function(a){a.preventDefault();var b=$(this);lahCookie.remove(b.parents(".item").prop("id")),b.parents(".item").removeClass("completed")}).on("click",".item .filter",function(a){a.preventDefault();var b=$(this),c=b.parents(".item").find("h5").html();$("#filter").val(c).change(),filterMake(c)}),$library.find(".clearQuery").on("click",function(a){a.preventDefault(),cleanHeader(),cleanQueries(),$(this).hide()}),$("#helpBtn").on("click",function(){$("#help").slideToggle()}),$("#filter").on("keydown",function(a){(13===a.keyCode||13===a.which)&&(filterMake($(this).val()),$(this).focus())}).clearSearch({callback:filterMake}),$("#search").on("keydown",function(a){(13===a.keyCode||13===a.which)&&(filterSearch($(this).val()),$(this).focus())}).clearSearch({callback:filterSearch}),$("#showCompleted").on("click",function(){var a=$(this);$library.find(".clearQuery").hide(),a.hasClass("btn-light")?(cleanQueries(["completed"]),a.find("span").html("hide"),$item.show(),$library.find("h3").html("All Elements")):(a.find("span").html("show"),$library.find("h3").html("Remaining Elements"),$item.filter(".completed").hide()),a.toggleClass("btn-light").toggleClass("btn-purple")}),$("#resetCompleted").on("click",function(){var a=$(this);a.hasClass("btn-light")?(a.toggleClass("btn-light").toggleClass("btn-danger"),a.find("span").html("Are you sure?"),setTimeout(function(){a.hasClass("btn-light")||a.toggleClass("btn-light").toggleClass("btn-danger").find("span").html("reset completed")},3e3)):a.hasClass("btn-danger")&&(a.toggleClass("btn-light").toggleClass("btn-danger").find("span").html("reset completed"),$item.removeClass("completed").show(),lahCookie.reset())}),$("#hideFinal").on("click",function(){$(".clearable").trigger("clear"),$("#hideFinal:checked").length?$("div.finalElement").hide():$("div.finalElement").show()}),$(document).on("click",".alert .close",function(){$(this).parent().fadeOut()}),$.dataSelector("!*",function(a,b){return-1===a.indexOf(b.toLowerCase())})});